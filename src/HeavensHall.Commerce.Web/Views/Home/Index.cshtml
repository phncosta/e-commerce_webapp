@using HeavensHall.Commerce.Domain.Enums;
@using HeavensHall.Commerce.Application.Extensions.EnumExtensions;
@model IEnumerable<HeavensHall.Commerce.Web.Models.ProductModel>

@{
    ViewData["Title"] = "Heaven's Hall Store - Instrumentos Musicais";
}

<!-- Carousel wrapper -->
<div id="carouselBasicExample" class="carousel slide carousel-fade" data-mdb-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
        <li data-mdb-target="#carouselBasicExample" data-mdb-slide-to="0" class="active"></li>
        <li data-mdb-target="#carouselBasicExample" data-mdb-slide-to="1"></li>
        <li data-mdb-target="#carouselBasicExample" data-mdb-slide-to="2"></li>
    </ol>

    <!-- Inner -->
    <div class="carousel-inner">
        <!-- Single item -->
        <div class="carousel-item active">
            <img src="https://mdbootstrap.com/img/Photos/Slides/img%20(15).jpg"
                 class="d-block w-100"
                 alt="..." />
            <div class="carousel-caption d-none d-md-block">
                <h5>Bem-vindo à Heaven's Hall!</h5>
                <p>A sua loja de instrumentos preferida</p>
            </div>
        </div>


        <!-- Single item -->
        <div class="carousel-item">
            <img src="~/img/layout/banners/banner_guitar_01.jpg"
                 class="d-block w-100"
                 alt="..." />
            <div class="carousel-caption d-none d-md-block">
                <h5></h5>
                <p></p>
            </div>
        </div>

        <!-- Single item -->
        <div class="carousel-item">
            <img src="https://mdbootstrap.com/img/Photos/Slides/img%20(23).jpg"
                 class="d-block w-100"
                 alt="..." />
            <div class="carousel-caption d-none d-md-block">
                <h5></h5>
                <p>

                </p>
            </div>
        </div>
    </div>
    <!-- Inner -->
    <!-- Controls -->
    <a class="carousel-control-prev"
       href="#carouselBasicExample"
       role="button"
       data-mdb-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </a>
    <a class="carousel-control-next"
       href="#carouselBasicExample"
       role="button"
       data-mdb-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </a>
</div>
<!-- Carousel wrapper -->
<!--Main layout-->
<main>
    <div class="container">

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <!-- Container wrapper -->
            <div class="container-fluid">
                <!-- Navbar brand -->
                <a class="navbar-brand" href="#">Instrumentos</a>

                <!-- Toggle button -->
                <button class="navbar-toggler"
                        type="button"
                        data-mdb-toggle="collapse"
                        data-mdb-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent"
                        aria-expanded="false"
                        aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Collapsible wrapper -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <!-- Left links -->
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">Promoções</a>
                        </li>

                        <!-- Navbar dropdown -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle"
                               href="#"
                               id="navbarDropdown"
                               role="button"
                               data-mdb-toggle="dropdown"
                               aria-expanded="false">
                                Categoria
                            </a>
                            <!-- Dropdown menu -->
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                @{
                                    foreach (InstrumentCategory category in Enum.GetValues(typeof(InstrumentCategory)))
                                    {
                                        <li><a class="dropdown-item" href="#">@category.GetDescription()</a></li>
                                    }
                                }
                            </ul>
                        </li>
                    </ul>
                    <!-- Left links -->
                    <!-- Search form -->
                    <form class="d-flex input-group w-auto">
                        <input type="search"
                               class="form-control"
                               placeholder="Produto"
                               aria-label="Search" />
                        <button class="btn btn-outline-primary"
                                type="button"
                                data-mdb-ripple-color="dark">
                            Pesquisar
                        </button>
                    </form>
                </div>
            </div>
        </nav>

        <!--Section: Products v.3-->
        <section class="text-center mb-4">

            <!--Grid row-->
            <div class="row wow fadeIn">
                @foreach (var product in Model)
                {
                    var image = product.Images?.Where(img => img.Main).SingleOrDefault();

                    <!--Grid column-->
                    <div class="col-lg-3 col-md-6 mb-4" style="cursor: pointer;">
                        <a asp-controller="produtos" asp-action="@product.Id">
                            <div class="card">
                                <!--Card image-->
                                <div class="view overlay">
                                    <img src="@if (image != null) { @image.Path }" height="350" class="card-img-top"
                                         alt="">
                                    <div class="mask rgba-white-slight"></div>
                                </div>
                                <!--Card content-->
                                <div class="card-body text-center">
                                    <!--Category & Title-->
                                    <div class="grey-text">
                                        <h5>@product.Name</h5>
                                    </div>
                                    <div class="dark-grey-text">
                                        @product.Brand.Name
                                    </div>
                                    <h4 class="font-weight-bold blue-text">
                                        <strong>R$ @product.Price</strong>
                                    </h4>
                                </div>
                                <div class="text-center pb-3">
                                    <button class="btn btn-outline-primary" type="button" asp-controller="produtos" asp-action="@product.Id" style="width: 30% !important">
                                        <!--TBD-->
                                        Ver
                                    </button>
                                    <button class="btn btn-primary shadow-2" type="button" href="#" style="width: 40% !important;">
                                        Comprar
                                    </button>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </section>

        <!--Pagination-->
        <div class="d-flex justify-content-center wow fadeIn">
            <ul class="pagination pg-blue">

                <!--Arrow left -->
                <li class="page-item" id="previous-page">
                    <a class="page-link" onclick="increaseOrDecreasePageBy(-1)">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
                <li class="page-item" id="page-selectable-1">
                    <a class="page-link" href="/pagina?num=1">
                        1
                    </a>
                </li>
                <li class="page-item" id="page-selectable-2">
                    <a class="page-link" href="/pagina?num=2">
                        2
                    </a>
                </li>
                <li class="page-item" id="page-selectable-3">
                    <a class="page-link" href="/pagina?num=3">
                        3
                    </a>
                </li>
                <li class="page-item" id="page-selectable-4">
                    <a class="page-link" href="/pagina?num=4">
                        4
                    </a>
                </li>
                <li class="page-item" id="page-selectable-5">
                    <a class="page-link" href="/pagina?num=5">
                        5
                    </a>
                </li>

                <!-- Arrow Right -->
                <li class="page-item" id="next-page">
                    <a class="page-link" onclick="increaseOrDecreasePageBy(1)">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- End Pagination -->

    </div>
</main>

<script>
    'use strict';

    document.addEventListener('DOMContentLoaded', function () {
        definePagination();
    });

    const PAGE_COUNT_PARAMETER = "num";
    var currentUrl = window.location.href;
    var url = new URL(currentUrl);
    var pageNumber = parseInt(url.searchParams.get(PAGE_COUNT_PARAMETER) ?? '1');

    const definePagination = () => {
        setCurrentPage(pageNumber);
        setPreviousAndNext(pageNumber);
    }

    const setCurrentPage = currentPageNumber => {
        let selectablePage = document.getElementById(`page-selectable-${currentPageNumber}`);
        selectablePage.classList.add('active');
    }

    const setPreviousAndNext = currentPageNumber => {
        var pagination = document.getElementsByClassName('pagination')[0];
        var nextPage = document.getElementById('next-page');
        var previousPage = document.getElementById('previous-page');

        var lastPage = pagination.children[pagination.children.length - 2];
        var lastPageNumber = lastPage.childNodes[1].innerText;

        currentPageNumber == 1 ? previousPage.classList.add('disabled') : previousPage.classList.remove('disabled');
        currentPageNumber == lastPageNumber ? nextPage.classList.add('disabled') : nextPage.classList.remove('disabled');
    }

    const increaseOrDecreasePageBy = value => {
        if (currentUrl.indexOf(`${PAGE_COUNT_PARAMETER}=`) != -1) {
            window.location.href = currentUrl.replace(`${PAGE_COUNT_PARAMETER}=${pageNumber}`, `${PAGE_COUNT_PARAMETER}=${pageNumber + value}`);
        } else {
            // Case when pagination was not been accessed (User is at default page 1).
            window.location.href = `/pagina?${PAGE_COUNT_PARAMETER}=2`;
        }
    }

</script>
